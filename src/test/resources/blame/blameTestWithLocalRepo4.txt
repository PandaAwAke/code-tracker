f415fb00b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 1)   package com.github.javaparser.printer.lexicalpreservation;
                                                                                                                                                                          2)
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 3)   import com.github.javaparser.GeneratedJavaParserConstants;
b29a46525 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:35:48 -0500 4)   import com.github.javaparser.TokenTypes;
f415fb00b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 5)   import com.github.javaparser.ast.Node;
3a31705ba javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-11-13 14:21:11 -0500 6)   import com.github.javaparser.ast.comments.Comment;
9e91a1d76 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 7)   import com.github.javaparser.printer.concretesyntaxmodel.*;
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 8)   import com.github.javaparser.printer.lexicalpreservation.LexicalDifferenceCalculator.CsmChild;
                                                                                                                                                                          9)
4b87b2b6b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:20:07 -0500 10)  import java.util.*;
                                                                                                                                                                          11)
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 12)  import static com.github.javaparser.GeneratedJavaParserConstants.*;
                                                                                                                                                                          13)
c73ae5d79 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 14)  /**
c73ae5d79 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 15)   * A Difference should give me a sequence of elements I should find (to indicate the context) followed by a list of elements
c73ae5d79 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 16)   * to remove or to add and follow by another sequence of elements.
c73ae5d79 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 17)   *
c73ae5d79 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 18)   * I should later be able to apply such difference to a nodeText.
c73ae5d79 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 19)   */
f415fb00b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 20)  public class Difference {
                                                                                                                                                                          21)
8cd140da3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2018-07-13 03:36:02 -0400 22)      public static final int STANDARD_INDENTATION_SIZE = 4;
                                                                                                                                                                          23)
b9976c5e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 20:36:23 -0400 24)      private final NodeText nodeText;
b9976c5e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 20:36:23 -0400 25)      private final Node node;
                                                                                                                                                                          26)
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 27)      private final List<DifferenceElement> diffElements;
29a9b8bcb javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 20:49:25 -0400 28)      private final List<TextElement> originalElements;
29a9b8bcb javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 20:49:25 -0400 29)      private int originalIndex = 0;
29a9b8bcb javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 20:49:25 -0400 30)      private int diffIndex = 0;
                                                                                                                                                                          31)
c35fbac21 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:23:45 -0400 32)      private final List<TokenTextElement> indentation;
c35fbac21 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:23:45 -0400 33)      private boolean addedIndentation = false;
                                                                                                                                                                          34)
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 35)      Difference(List<DifferenceElement> diffElements, NodeText nodeText, Node node) {
29a9b8bcb javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 20:49:25 -0400 36)          if (nodeText == null) {
29a9b8bcb javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 20:49:25 -0400 37)              throw new NullPointerException("nodeText can not be null");
29a9b8bcb javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 20:49:25 -0400 38)          }
                                                                                                                                                                          39)
b9976c5e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 20:36:23 -0400 40)          this.nodeText = nodeText;
b9976c5e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 20:36:23 -0400 41)          this.node = node;
04f28d402 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 20:42:18 -0400 42)          this.diffElements = diffElements;
29a9b8bcb javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 20:49:25 -0400 43)          this.originalElements = nodeText.getElements();
                                                                                                                                                                          44)
c35fbac21 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:23:45 -0400 45)          this.indentation = LexicalPreservingPrinter.findIndentation(node);
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 46)      }
                                                                                                                                                                          47)
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 48)      private List<TextElement> processIndentation(List<TokenTextElement> indentation, List<TextElement> prevElements) {
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 49)          List<TextElement> res = new LinkedList<>();
48ac9477b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 50)          res.addAll(indentation);
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 51)          boolean afterNl = false;
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 52)          for (TextElement e : prevElements) {
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 53)              if (e.isNewline() || e.isToken(SINGLE_LINE_COMMENT)) {
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 54)                  res.clear();
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 55)                  afterNl = true;
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 56)              } else {
b29a46525 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:35:48 -0500 57)                  if (afterNl && e instanceof TokenTextElement && TokenTypes.isWhitespace(((TokenTextElement)e).getTokenKind())) {
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 58)                      res.add(e);
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 59)                  } else {
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 60)                      afterNl = false;
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 61)                  }
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 62)              }
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 63)          }
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 64)          return res;
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 65)      }
                                                                                                                                                                          66)
48ac9477b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 67)      private List<TextElement> indentationBlock() {
48ac9477b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 68)          List<TextElement> res = new LinkedList<>();
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 69)          res.add(new TokenTextElement(SPACE));
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 70)          res.add(new TokenTextElement(SPACE));
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 71)          res.add(new TokenTextElement(SPACE));
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 72)          res.add(new TokenTextElement(SPACE));
48ac9477b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 73)          return res;
48ac9477b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 74)      }
                                                                                                                                                                          75)
548fb9c5a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 76)      private boolean isAfterLBrace(NodeText nodeText, int nodeTextIndex) {
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 77)          if (nodeTextIndex > 0 && nodeText.getElements().get(nodeTextIndex - 1).isToken(LBRACE)) {
548fb9c5a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 78)              return true;
48ac9477b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 79)          }
de5c17c37 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-17 18:47:50 -0400 80)          if (nodeTextIndex > 0 && nodeText.getElements().get(nodeTextIndex - 1).isSpaceOrTab()) {
548fb9c5a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 81)              return isAfterLBrace(nodeText, nodeTextIndex - 1);
548fb9c5a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 82)          }
548fb9c5a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 83)          return false;
548fb9c5a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 84)      }
                                                                                                                                                                          85)
23226e3be javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-08-12 18:08:50 -0400 86)      /**
23226e3be javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-08-12 18:08:50 -0400 87)       * If we are at the beginning of a line, with just spaces or tabs before us we should force the space to be
23226e3be javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-08-12 18:08:50 -0400 88)       * the same as the indentation.
23226e3be javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-08-12 18:08:50 -0400 89)       */
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 90)      private int considerEnforcingIndentation(NodeText nodeText, int nodeTextIndex) {
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 91)          boolean hasOnlyWsBefore = true;
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 92)          for (int i = nodeTextIndex; i >= 0 && hasOnlyWsBefore && i < nodeText.getElements().size(); i--) {
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 93)              if (nodeText.getElements().get(i).isNewline()) {
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 94)                  break;
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 95)              }
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 96)              if (!nodeText.getElements().get(i).isSpaceOrTab()) {
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 97)                  hasOnlyWsBefore = false;
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 98)              }
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 99)          }
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 100)         if (hasOnlyWsBefore) {
7a48b21bb javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-07-19 11:12:51 -0400 101)             for (int i = nodeTextIndex; i >= 0 && i < nodeText.getElements().size(); i--) {
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 102)                 if (nodeText.getElements().get(i).isNewline()) {
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 103)                     break;
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 104)                 }
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 105)                 nodeText.removeElement(i);
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 106)             }
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 107)         }
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 108)         return nodeTextIndex;
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 109)     }
                                                                                                                                                                          110)
15cb49e74 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 12:39:44 -0500 111)     /**
15cb49e74 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 12:39:44 -0500 112)      * Node that we have calculate the Difference we can apply to a concrete NodeText, modifying it according
15cb49e74 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 12:39:44 -0500 113)      * to the difference (adding and removing the elements provided).
15cb49e74 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 12:39:44 -0500 114)      */
b9976c5e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 20:36:23 -0400 115)     void apply() {
996b78486 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 116)         extractReshuffledDiffElements(diffElements);
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 117)         Map<Removed, RemovedGroup> removedGroups = combineRemovedElementsToRemovedGroups();
                                                                                                                                                                          118)
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 119)         do {
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 120)             boolean isLeftOverDiffElement = applyLeftOverDiffElements();
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 121)             boolean isLeftOverOriginalElement = applyLeftOverOriginalElements();
                                                                                                                                                                          122)
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 123)             if (!isLeftOverDiffElement && !isLeftOverOriginalElement){
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 124)                 DifferenceElement diffElement = diffElements.get(diffIndex);
                                                                                                                                                                          125)
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 126)                 if (diffElement instanceof Added) {
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 127)                     applyAddedDiffElement((Added) diffElement);
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 128)                 } else {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 129)                     TextElement originalElement = originalElements.get(originalIndex);
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 130)                     boolean originalElementIsChild = originalElement instanceof ChildTextElement;
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 131)                     boolean originalElementIsToken = originalElement instanceof TokenTextElement;
                                                                                                                                                                          132)
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 133)                     if (diffElement instanceof Kept) {
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 134)                         applyKeptDiffElement((Kept) diffElement, originalElement, originalElementIsChild, originalElementIsToken);
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 135)                     } else if (diffElement instanceof Removed) {
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 136)                         Removed removed = (Removed) diffElement;
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 137)                         applyRemovedDiffElement(removedGroups.get(removed), removed, originalElement, originalElementIsChild, originalElementIsToken);
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 138)                     } else {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 139)                         throw new UnsupportedOperationException("" + diffElement + " vs " + originalElement);
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 140)                     }
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 141)                 }
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 142)             }
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 143)         } while (diffIndex < diffElements.size() || originalIndex < originalElements.size());
                                                                                                                                                                          144)     }
                                                                                                                                                                          145)
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 146)     private boolean applyLeftOverOriginalElements() {
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 147)         boolean isLeftOverElement = false;
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 148)         if (diffIndex >= diffElements.size() && originalIndex < originalElements.size()) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 149)             TextElement originalElement = originalElements.get(originalIndex);
                                                                                                                                                                          150)
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 151)             if (originalElement.isWhiteSpaceOrComment()) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 152)                 originalIndex++;
f4ce6ce92 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 153)             } else {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 154)                 throw new UnsupportedOperationException("NodeText: " + nodeText + ". Difference: "
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 155)                         + this + " " + originalElement);
f4ce6ce92 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 156)             }
                                                                                                                                                                          157)
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 158)             isLeftOverElement = true;
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 159)         }
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 160)         return isLeftOverElement;
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 161)     }
                                                                                                                                                                          162)
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 163)     private boolean applyLeftOverDiffElements() {
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 164)         boolean isLeftOverElement = false;
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 165)         if (diffIndex < diffElements.size() && originalIndex >= originalElements.size()) {
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 166)             DifferenceElement diffElement = diffElements.get(diffIndex);
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 167)             if (diffElement instanceof Kept) {
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 168)                 Kept kept = (Kept) diffElement;
                                                                                                                                                                          169)
0a54807d5 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Jooyung Han         2018-05-29 02:28:48 -0400 170)                 if (kept.isWhiteSpaceOrComment() || kept.isIndent() || kept.isUnindent()) {
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 171)                     diffIndex++;
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 172)                 } else {
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 173)                     throw new IllegalStateException("Cannot keep element because we reached the end of nodetext: "
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 174)                             + nodeText + ". Difference: " + this);
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 175)                 }
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 176)             } else if (diffElement instanceof Added) {
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 177)                 Added addedElement = (Added) diffElement;
                                                                                                                                                                          178)
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 179)                 nodeText.addElement(originalIndex, addedElement.toTextElement());
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 180)                 originalIndex++;
01e9c9079 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 181)                 diffIndex++;
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 182)             } else {
fb8daf167 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-17 17:24:24 -0400 183)                 throw new UnsupportedOperationException(diffElement.getClass().getSimpleName());
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 184)             }
                                                                                                                                                                          185)
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 186)             isLeftOverElement = true;
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 187)         }
                                                                                                                                                                          188)
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 189)         return isLeftOverElement;
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 190)     }
                                                                                                                                                                          191)
996b78486 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 192)     private void extractReshuffledDiffElements(List<DifferenceElement> diffElements) {
996b78486 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 193)         for (int index = 0; index < diffElements.size(); index++) {
996b78486 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 194)             DifferenceElement diffElement = diffElements.get(index);
996b78486 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 195)             if (diffElement instanceof Reshuffled) {
996b78486 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 196)                 Reshuffled reshuffled = (Reshuffled) diffElement;
                                                                                                                                                                          197)
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 198)                 // First, let's see how many tokens we need to attribute to the previous version of the of the CsmMix
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 199)                 CsmMix elementsFromPreviousOrder = reshuffled.getPreviousOrder();
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 200)                 CsmMix elementsFromNextOrder = reshuffled.getNextOrder();
                                                                                                                                                                          201)
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 202)                 // This contains indexes from elementsFromNextOrder to indexes from elementsFromPreviousOrder
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 203)                 Map<Integer, Integer> correspondanceBetweenNextOrderAndPreviousOrder = getCorrespondanceBetweenNextOrderAndPreviousOrder(elementsFromPreviousOrder, elementsFromNextOrder);
                                                                                                                                                                          204)
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 205)                 // We now find out which Node Text elements corresponds to the elements in the original CSM
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 206)                 List<Integer> nodeTextIndexOfPreviousElements = findIndexOfCorrespondingNodeTextElement(elementsFromPreviousOrder.getElements(), nodeText, originalIndex, node);
                                                                                                                                                                          207)
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 208)                 Map<Integer, Integer> nodeTextIndexToPreviousCSMIndex = new HashMap<>();
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 209)                 for (int i = 0; i < nodeTextIndexOfPreviousElements.size(); i++) {
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 210)                     int value = nodeTextIndexOfPreviousElements.get(i);
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 211)                     if (value != -1) {
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 212)                         nodeTextIndexToPreviousCSMIndex.put(value, i);
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 213)                     }
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 214)                 }
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 215)                 int lastNodeTextIndex = nodeTextIndexOfPreviousElements.stream().max(Integer::compareTo).orElse(-1);
                                                                                                                                                                          216)
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 217)                 // Elements to be added at the end
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 218)                 List<CsmElement> elementsToBeAddedAtTheEnd = new LinkedList<>();
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 219)                 List<CsmElement> nextOrderElements = elementsFromNextOrder.getElements();
                                                                                                                                                                          220)
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 221)                 Map<Integer, List<CsmElement>> elementsToAddBeforeGivenOriginalCSMElement = new HashMap<>();
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 222)                 for (int ni = 0; ni < nextOrderElements.size(); ni++) {
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 223)                     // If it has a mapping, then it is kept
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 224)                     if (!correspondanceBetweenNextOrderAndPreviousOrder.containsKey(ni)) {
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 225)                         // Ok, it is something new. Where to put it? Let's see what is the first following
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 226)                         // element that has a mapping
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 227)                         int originalCsmIndex = -1;
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 228)                         for (int nj = ni + 1; nj < nextOrderElements.size() && originalCsmIndex == -1; nj++) {
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 229)                             if (correspondanceBetweenNextOrderAndPreviousOrder.containsKey(nj)) {
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 230)                                 originalCsmIndex = correspondanceBetweenNextOrderAndPreviousOrder.get(nj);
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 231)                                 if (!elementsToAddBeforeGivenOriginalCSMElement.containsKey(originalCsmIndex)) {
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 232)                                     elementsToAddBeforeGivenOriginalCSMElement.put(originalCsmIndex, new LinkedList<>());
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 233)                                 }
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 234)                                 elementsToAddBeforeGivenOriginalCSMElement.get(originalCsmIndex).add(nextOrderElements.get(ni));
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 235)                             }
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 236)                         }
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 237)                         // it does not preceed anything, so it goes at the end
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 238)                         if (originalCsmIndex == -1) {
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 239)                             elementsToBeAddedAtTheEnd.add(nextOrderElements.get(ni));
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 240)                         }
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 241)                     }
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 242)                 }
                                                                                                                                                                          243)
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 244)                 // We go over the original node text elements, in the order they appear in the NodeText.
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 245)                 // Considering an original node text element (ONE)
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 246)                 // * we verify if it corresponds to a CSM element. If it does not we just move on, otherwise
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 247)                 //   we find the correspond OCE (Original CSM Element)
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 248)                 // * we first add new elements that are marked to be added before OCE
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 249)                 // * if OCE is marked to be present also in the "after" CSM we add a kept element,
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 250)                 //   otherwise we add a removed element
                                                                                                                                                                          251)
996b78486 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 252)                 // Remove the whole Reshuffled element
996b78486 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 253)                 diffElements.remove(index);
                                                                                                                                                                          254)
996b78486 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 255)                 int diffElIterator = index;
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 256)                 if (lastNodeTextIndex != -1) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 257)                     for (int ntIndex = originalIndex; ntIndex <= lastNodeTextIndex; ntIndex++) {
                                                                                                                                                                          258)
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 259)                         if (nodeTextIndexToPreviousCSMIndex.containsKey(ntIndex)) {
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 260)                             int indexOfOriginalCSMElement = nodeTextIndexToPreviousCSMIndex.get(ntIndex);
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 261)                             if (elementsToAddBeforeGivenOriginalCSMElement.containsKey(indexOfOriginalCSMElement)) {
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 262)                                 for (CsmElement elementToAdd : elementsToAddBeforeGivenOriginalCSMElement.get(indexOfOriginalCSMElement)) {
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 263)                                     diffElements.add(diffElIterator++, new Added(elementToAdd));
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 264)                                 }
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 265)                             }
                                                                                                                                                                          266)
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 267)                             CsmElement originalCSMElement = elementsFromPreviousOrder.getElements().get(indexOfOriginalCSMElement);
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 268)                             boolean toBeKept = correspondanceBetweenNextOrderAndPreviousOrder.containsValue(indexOfOriginalCSMElement);
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 269)                             if (toBeKept) {
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 270)                                 diffElements.add(diffElIterator++, new Kept(originalCSMElement));
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 271)                             } else {
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 272)                                 diffElements.add(diffElIterator++, new Removed(originalCSMElement));
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 273)                             }
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 274)                         }
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 275)                         // else we have a simple node text element, without associated csm element, just keep ignore it
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 276)                     }
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 277)                 }
                                                                                                                                                                          278)
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 279)                 // Finally we look for the remaining new elements that were not yet added and
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 280)                 // add all of them
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 281)                 for (CsmElement elementToAdd : elementsToBeAddedAtTheEnd) {
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 282)                     diffElements.add(diffElIterator++, new Added(elementToAdd));
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 283)                 }
996b78486 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 284)             }
996b78486 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 285)         }
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 286)     }
                                                                                                                                                                          287)
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 288)     /**
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 289)      * Maps all Removed elements as keys to their corresponding RemovedGroup.
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 290)      * A RemovedGroup contains all consecutive Removed elements.
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 291)      * <br/>
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 292)      * Example:
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 293)      * <pre>
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 294)      * Elements: Kept|Removed1|Removed2|Kept|Removed3|Added|Removed4
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 295)      * Groups:        <----Group1---->       Group2         Group3
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 296)      * Keys:          Removed1+Removed2      Removed3       Removed4
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 297)      * </pre>
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 298)      *
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 299)      * @return Map with all Removed elements as keys to their corresponding RemovedGroup
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 300)      */
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 301)     private Map<Removed, RemovedGroup> combineRemovedElementsToRemovedGroups() {
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 302)         Map<Integer, List<Removed>> removedElementsMap = groupConsecutiveRemovedElements();
                                                                                                                                                                          303)
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 304)         List<RemovedGroup> removedGroups = new ArrayList<>();
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 305)         for (Map.Entry<Integer, List<Removed>> entry : removedElementsMap.entrySet()) {
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 306)             removedGroups.add(RemovedGroup.of(entry.getKey(), entry.getValue()));
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 307)         }
                                                                                                                                                                          308)
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 309)         Map<Removed, RemovedGroup> map = new HashMap<>();
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 310)         for (RemovedGroup removedGroup : removedGroups){
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 311)             for (Removed index : removedGroup) {
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 312)                 map.put(index, removedGroup);
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 313)             }
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 314)         }
                                                                                                                                                                          315)
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 316)         return map;
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 317)     }
                                                                                                                                                                          318)
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 319)     private Map<Integer, List<Removed>> groupConsecutiveRemovedElements() {
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 320)         Map<Integer, List<Removed>> removedElementsMap = new HashMap<>();
                                                                                                                                                                          321)
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 322)         Integer firstElement = null;
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 323)         for (int i = 0; i < diffElements.size(); i++) {
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 324)             DifferenceElement diffElement = diffElements.get(i);
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 325)             if (diffElement instanceof Removed) {
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 326)                 if (firstElement == null) {
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 327)                     firstElement = i;
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 328)                 }
                                                                                                                                                                          329)
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 330)                 removedElementsMap.computeIfAbsent(firstElement, key -> new ArrayList<>())
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 331)                         .add((Removed) diffElement);
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 332)             } else {
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 333)                 firstElement = null;
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 334)             }
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 335)         }
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 336)         return removedElementsMap;
797bf5367 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 337)     }
                                                                                                                                                                          338)
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 339)     private void applyRemovedDiffElement(RemovedGroup removedGroup, Removed removed, TextElement originalElement, boolean originalElementIsChild, boolean originalElementIsToken) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 340)         if (removed.isChild() && originalElementIsChild) {
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 341)             ChildTextElement originalElementChild = (ChildTextElement) originalElement;
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 342)             if (originalElementChild.isComment()) {
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 343)                 // We expected to remove a proper node but we found a comment in between.
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 344)                 // If the comment is associated to the node we want to remove we remove it as well, otherwise we keep it
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 345)                 Comment comment = (Comment) originalElementChild.getChild();
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 346)                 if (!comment.isOrphan() && comment.getCommentedNode().isPresent() && comment.getCommentedNode().get().equals(removed.getChild())) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 347)                     nodeText.removeElement(originalIndex);
3a31705ba javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-11-13 14:21:11 -0500 348)                 } else {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 349)                     originalIndex++;
3a31705ba javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-11-13 14:21:11 -0500 350)                 }
3a31705ba javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-11-13 14:21:11 -0500 351)             } else {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 352)                 nodeText.removeElement(originalIndex);
                                                                                                                                                                          353)
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 354)                 if ((diffIndex + 1 >= diffElements.size() || !(diffElements.get(diffIndex + 1) instanceof Added))
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 355)                         && !removedGroup.isACompleteLine()) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 356)                     originalIndex = considerEnforcingIndentation(nodeText, originalIndex);
ed7f4a653 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 357)                 }
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 358)                 // If in front we have one space and before also we had space let's drop one space
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 359)                 if (originalElements.size() > originalIndex && originalIndex > 0) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 360)                     if (originalElements.get(originalIndex).isWhiteSpace()
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 361)                             && originalElements.get(originalIndex - 1).isWhiteSpace()) {
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 362)                         // However we do not want to do that when we are about to adding or removing elements
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 363)                         if ((diffIndex + 1) == diffElements.size() || (diffElements.get(diffIndex + 1) instanceof Kept)) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 364)                             originalElements.remove(originalIndex--);
74dc0e58a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 365)                         }
74dc0e58a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 366)                     }
74dc0e58a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 367)                 }
                                                                                                                                                                          368)
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 369)                 diffIndex++;
3a31705ba javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-11-13 14:21:11 -0500 370)             }
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 371)         } else if (removed.isToken() && originalElementIsToken
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 372)                 && (removed.getTokenType() == ((TokenTextElement) originalElement).getTokenKind())) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 373)             nodeText.removeElement(originalIndex);
01e9c9079 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 374)             diffIndex++;
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 375)         } else if (originalElementIsToken && originalElement.isWhiteSpaceOrComment()) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 376)             originalIndex++;
de5c17c37 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-17 18:47:50 -0400 377)         } else if (removed.isPrimitiveType()) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 378)             if (isPrimitiveType(originalElement)) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 379)                 nodeText.removeElement(originalIndex);
26bf9b3ff javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 380)                 diffIndex++;
26bf9b3ff javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 381)             } else {
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 382)                 throw new UnsupportedOperationException("removed " + removed.getElement() + " vs " + originalElement);
26bf9b3ff javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 383)             }
de5c17c37 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-17 18:47:50 -0400 384)         } else if (removed.isWhiteSpace()) {
f0f313058 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 385)             diffIndex++;
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 386)         } else if (originalElement.isWhiteSpace()) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 387)             originalIndex++;
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 388)         } else {
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 389)             throw new UnsupportedOperationException("removed " + removed.getElement() + " vs " + originalElement);
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 390)         }
                                                                                                                                                                          391)
4f9e0c67e javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 392)         cleanTheLineOfLeftOverSpace(removedGroup, removed);
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 393)     }
                                                                                                                                                                          394)
b8035a7ac javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 395)     /**
b8035a7ac javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 396)      * Cleans the line of left over space if there is unnecessary indentation and the element will not be replaced
b8035a7ac javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 397)      */
4f9e0c67e javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 398)     private void cleanTheLineOfLeftOverSpace(RemovedGroup removedGroup, Removed removed) {
b8035a7ac javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 399)         if (originalIndex >= originalElements.size()) {
b8035a7ac javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 400)             // if all elements were already processed there is nothing to do
b8035a7ac javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 401)             return;
b8035a7ac javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 402)         }
                                                                                                                                                                          403)
4f9e0c67e javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 404)         if (!removedGroup.isProcessed()
4f9e0c67e javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 405)                 && removedGroup.getLastElement() == removed
4f9e0c67e javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 406)                 && removedGroup.isACompleteLine()) {
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 407)             Integer lastElementIndex = removedGroup.getLastElementIndex();
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 408)             Optional<Integer> indentation = removedGroup.getIndentation();
                                                                                                                                                                          409)
4f9e0c67e javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 410)             if (indentation.isPresent() && !isReplaced(lastElementIndex)) {
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 411)                 for (int i = 0; i < indentation.get(); i++) {
4f9e0c67e javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 412)                     if (originalElements.get(originalIndex).isSpaceOrTab()) {
b8035a7ac javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 413)                         // If the current element is a space, remove it
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 414)                         nodeText.removeElement(originalIndex);
b8035a7ac javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 415)                     } else if (originalIndex >= 1 && originalElements.get(originalIndex - 1).isSpaceOrTab()) {
b8035a7ac javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 416)                         // If the current element is not a space itself we remove the space in front of it
4f9e0c67e javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 417)                         nodeText.removeElement(originalIndex - 1);
4f9e0c67e javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 418)                         originalIndex--;
882790065 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 419)                     }
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 420)                 }
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 421)             }
                                                                                                                                                                          422)
4f9e0c67e javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 423)             // Mark RemovedGroup as processed
4f9e0c67e javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 424)             removedGroup.processed();
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 425)         }
4f9e0c67e javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 426)     }
                                                                                                                                                                          427)
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 428)     private void applyKeptDiffElement(Kept kept, TextElement originalElement, boolean originalElementIsChild, boolean originalElementIsToken) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 429)         if (originalElement.isComment()) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 430)             originalIndex++;
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 431)         } else if (kept.isChild() && originalElementIsChild) {
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 432)             diffIndex++;
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 433)             originalIndex++;
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 434)         } else if (kept.isChild() && originalElementIsToken) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 435)             if (originalElement.isWhiteSpaceOrComment()) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 436)                 originalIndex++;
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 437)             } else {
de5c17c37 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-17 18:47:50 -0400 438)                 if (kept.isPrimitiveType()) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 439)                     originalIndex++;
ecefb7772 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 440)                     diffIndex++;
ecefb7772 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 441)                 } else {
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 442)                     throw new UnsupportedOperationException("kept " + kept.getElement() + " vs " + originalElement);
ecefb7772 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 443)                 }
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 444)             }
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 445)         } else if (kept.isToken() && originalElementIsToken) {
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 446)             TokenTextElement originalTextToken = (TokenTextElement) originalElement;
                                                                                                                                                                          447)
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 448)             if (kept.getTokenType() == originalTextToken.getTokenKind()) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 449)                 originalIndex++;
f4ce6ce92 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 450)                 diffIndex++;
de5c17c37 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-17 18:47:50 -0400 451)             } else if (kept.isWhiteSpaceOrComment()) {
01e9c9079 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 452)                 diffIndex++;
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 453)             } else if (originalTextToken.isWhiteSpaceOrComment()) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 454)                 originalIndex++;
f4ce6ce92 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 455)             } else {
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 456)                 throw new UnsupportedOperationException("Csm token " + kept.getElement() + " NodeText TOKEN " + originalTextToken);
f4ce6ce92 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 457)             }
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 458)         } else if (kept.isWhiteSpace()) {
b2625a83a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 459)             diffIndex++;
de5c17c37 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-17 18:47:50 -0400 460)         } else if (kept.isIndent()) {
a31908d22 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 461)             diffIndex++;
de5c17c37 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-17 18:47:50 -0400 462)         } else if (kept.isUnindent()) {
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 463)             // Nothing to do, beside considering indentation
a31908d22 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 464)             diffIndex++;
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 465)             for (int i = 0; i < STANDARD_INDENTATION_SIZE && originalIndex >= 1 && nodeText.getTextElement(originalIndex - 1).isSpaceOrTab(); i++) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 466)                 nodeText.removeElement(--originalIndex);
5689cad20 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 467)             }
adb78b277 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-03-05 05:02:36 -0500 468)         } else {
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 469)             throw new UnsupportedOperationException("kept " + kept.getElement() + " vs " + originalElement);
adb78b277 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-03-05 05:02:36 -0500 470)         }
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 471)     }
                                                                                                                                                                          472)
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 473)     private void applyAddedDiffElement(Added added) {
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 474)         if (added.isIndent()) {
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 475)             for (int i=0;i<STANDARD_INDENTATION_SIZE;i++){
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 476)                 indentation.add(new TokenTextElement(GeneratedJavaParserConstants.SPACE));
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 477)             }
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 478)             addedIndentation = true;
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 479)             diffIndex++;
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 480)             return;
488ccb119 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 481)         }
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 482)         if (added.isUnindent()) {
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 483)             for (int i = 0; i<STANDARD_INDENTATION_SIZE && !indentation.isEmpty(); i++){
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 484)                 indentation.remove(indentation.size() - 1);
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 485)             }
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 486)             addedIndentation = false;
488ccb119 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 487)             diffIndex++;
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 488)             return;
488ccb119 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 489)         }
                                                                                                                                                                          490)
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 491)         TextElement addedTextElement = added.toTextElement();
572ea8939 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 492)         boolean used = false;
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 493)         if (originalIndex > 0 && originalElements.get(originalIndex - 1).isNewline()) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 494)             for (TextElement e : processIndentation(indentation, originalElements.subList(0, originalIndex - 1))) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 495)                 nodeText.addElement(originalIndex++, e);
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 496)             }
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 497)         } else if (isAfterLBrace(nodeText, originalIndex) && !isAReplacement(diffIndex)) {
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 498)             if (addedTextElement.isNewline()) {
572ea8939 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 499)                 used = true;
572ea8939 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 500)             }
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 501)             nodeText.addElement(originalIndex++, new TokenTextElement(TokenTypes.eolTokenKind()));
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 502)             // This remove the space in "{ }" when adding a new line
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 503)             while (originalElements.get(originalIndex).isSpaceOrTab()) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 504)                 originalElements.remove(originalIndex);
152592f7c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 505)             }
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 506)             for (TextElement e : processIndentation(indentation, originalElements.subList(0, originalIndex - 1))) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 507)                 nodeText.addElement(originalIndex++, e);
48ac9477b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 508)             }
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 509)             // Indentation is painful...
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 510)             // Sometimes we want to force indentation: this is the case when indentation was expected but
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 511)             // was actually not there. For example if we have "{ }" we would expect indentation but it is
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 512)             // not there, so when adding new elements we force it. However if the indentation has been
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 513)             // inserted by us in this transformation we do not want to insert it again
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 514)             if (!addedIndentation) {
48ac9477b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 515)                 for (TextElement e : indentationBlock()) {
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 516)                     nodeText.addElement(originalIndex++, e);
48ac9477b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 517)                 }
ad402162f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 518)             }
5d76ede0d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 519)         }
                                                                                                                                                                          520)
572ea8939 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 521)         if (!used) {
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 522)             nodeText.addElement(originalIndex, addedTextElement);
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 523)             originalIndex++;
572ea8939 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 524)         }
                                                                                                                                                                          525)
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 526)         if (addedTextElement.isNewline()) {
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 527)             boolean followedByUnindent = isFollowedByUnindent(diffElements, diffIndex);
2ae6f779c javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 16:05:42 -0400 528)             originalIndex = adjustIndentation(indentation, nodeText, originalIndex, followedByUnindent/* && !addedIndentation*/);
7121d100d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 529)         }
                                                                                                                                                                          530)
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 531)         diffIndex++;
b7bd15d12 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:34:00 -0400 532)     }
                                                                                                                                                                          533)
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 534)     private Map<Integer, Integer> getCorrespondanceBetweenNextOrderAndPreviousOrder(CsmMix elementsFromPreviousOrder, CsmMix elementsFromNextOrder) {
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 535)         Map<Integer, Integer> correspondanceBetweenNextOrderAndPreviousOrder = new HashMap<>();
                                                                                                                                                                          536)
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 537)         List<CsmElement> nextOrderElements = elementsFromNextOrder.getElements();
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 538)         for (int ni = 0; ni< nextOrderElements.size(); ni++) {
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 539)             boolean found = false;
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 540)             CsmElement ne = nextOrderElements.get(ni);
                                                                                                                                                                          541)
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 542)             List<CsmElement> previousOrderElements = elementsFromPreviousOrder.getElements();
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 543)             for (int pi = 0; pi< previousOrderElements.size() && !found; pi++) {
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 544)                 CsmElement pe = previousOrderElements.get(pi);
40f6fef07 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 19:51:14 -0400 545)                 if (!correspondanceBetweenNextOrderAndPreviousOrder.values().contains(pi)
40f6fef07 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 19:51:14 -0400 546)                         && DifferenceElementCalculator.matching(ne, pe)) {
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 547)                     found = true;
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 548)                     correspondanceBetweenNextOrderAndPreviousOrder.put(ni, pi);
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 549)                 }
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 550)             }
f8d5e2fda javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 551)         }
                                                                                                                                                                          552)
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 553)         return correspondanceBetweenNextOrderAndPreviousOrder;
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 554)     }
                                                                                                                                                                          555)
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 556)     private boolean isFollowedByUnindent(List<DifferenceElement> diffElements, int diffIndex) {
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 557)         return (diffIndex + 1) < diffElements.size()
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 558)                 && diffElements.get(diffIndex + 1).isAdded()
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 559)                 && diffElements.get(diffIndex + 1).getElement() instanceof CsmUnindent;
7f177dcaa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 17:48:21 -0400 560)     }
                                                                                                                                                                          561)
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 562)     private List<Integer> findIndexOfCorrespondingNodeTextElement(List<CsmElement> elements, NodeText nodeText, int startIndex, Node node) {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 563)         List<Integer> correspondingIndices = new ArrayList<>();
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 564)         for (ListIterator<CsmElement> csmElementListIterator = elements.listIterator(); csmElementListIterator.hasNext(); ) {
                                                                                                                                                                          565)
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 566)             int previousCsmElementIndex = csmElementListIterator.previousIndex();
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 567)             CsmElement csmElement = csmElementListIterator.next();
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 568)             int nextCsmElementIndex = csmElementListIterator.nextIndex();
                                                                                                                                                                          569)
c4bbfa706 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 19:26:24 -0400 570)             Map<MatchClassification, Integer> potentialMatches = new EnumMap<>(MatchClassification.class);
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 571)             for (int i = startIndex; i< nodeText.getElements().size(); i++){
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 572)                 if (!correspondingIndices.contains(i)) {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 573)                     TextElement textElement = nodeText.getTextElement(i);
                                                                                                                                                                          574)
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 575)                     boolean isCorresponding = isCorrespondingElement(textElement, csmElement, node);
                                                                                                                                                                          576)
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 577)                     if (isCorresponding) {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 578)                         boolean hasSamePreviousElement = false;
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 579)                         if (i > 0 && previousCsmElementIndex > -1) {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 580)                             TextElement previousTextElement = nodeText.getTextElement(i - 1);
                                                                                                                                                                          581)
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 582)                             hasSamePreviousElement = isCorrespondingElement(previousTextElement, elements.get(previousCsmElementIndex), node);
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 583)                         }
                                                                                                                                                                          584)
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 585)                         boolean hasSameNextElement = false;
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 586)                         if (i < nodeText.getElements().size() - 1 && nextCsmElementIndex < elements.size()) {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 587)                             TextElement nextTextElement = nodeText.getTextElement(i + 1);
                                                                                                                                                                          588)
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 589)                             hasSameNextElement = isCorrespondingElement(nextTextElement, elements.get(nextCsmElementIndex), node);
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 590)                         }
                                                                                                                                                                          591)
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 592)                         if (hasSamePreviousElement && hasSameNextElement) {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 593)                             potentialMatches.putIfAbsent(MatchClassification.ALL, i);
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 594)                         } else if (hasSamePreviousElement) {
ae539a6fa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-11 12:03:15 -0400 595)                             potentialMatches.putIfAbsent(MatchClassification.PREVIOUS_AND_SAME, i);
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 596)                         } else if (hasSameNextElement) {
ae539a6fa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-11 12:03:15 -0400 597)                             potentialMatches.putIfAbsent(MatchClassification.NEXT_AND_SAME, i);
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 598)                         } else {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 599)                             potentialMatches.putIfAbsent(MatchClassification.SAME_ONLY, i);
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 600)                         }
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 601)                     }
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 602)                 }
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 603)             }
                                                                                                                                                                          604)
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 605)             // Prioritize the matches from best to worst
c4bbfa706 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 19:26:24 -0400 606)             Optional<MatchClassification> bestMatchKey = potentialMatches.keySet().stream()
c4bbfa706 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 19:26:24 -0400 607)                     .min(Comparator.comparing(MatchClassification::getPriority));
                                                                                                                                                                          608)
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 609)             if (bestMatchKey.isPresent()) {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 610)                 correspondingIndices.add(potentialMatches.get(bestMatchKey.get()));
ae539a6fa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-11 12:03:15 -0400 611)             } else {
ae539a6fa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-11 12:03:15 -0400 612)                 correspondingIndices.add(-1);
ae539a6fa javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-11 12:03:15 -0400 613)             }
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 614)         }
                                                                                                                                                                          615)
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 616)         return correspondingIndices;
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 617)     }
                                                                                                                                                                          618)
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 619)     private enum MatchClassification {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 620)         ALL(1), PREVIOUS_AND_SAME(2), NEXT_AND_SAME(3), SAME_ONLY(4);
                                                                                                                                                                          621)
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 622)         private final int priority;
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 623)         MatchClassification(int priority) {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 624)             this.priority = priority;
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 625)         }
                                                                                                                                                                          626)
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 627)         int getPriority() {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 628)             return priority;
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 629)         }
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 630)     }
                                                                                                                                                                          631)
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 632)     private boolean isCorrespondingElement(TextElement textElement, CsmElement csmElement, Node node) {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 633)         if (csmElement instanceof CsmToken) {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 634)             CsmToken csmToken = (CsmToken)csmElement;
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 635)             if (textElement instanceof TokenTextElement) {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 636)                 TokenTextElement tokenTextElement = (TokenTextElement)textElement;
c4bbfa706 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 19:26:24 -0400 637)                 return tokenTextElement.getTokenKind() == csmToken.getTokenType() && tokenTextElement.getText().equals(csmToken.getContent(node));
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 638)             }
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 639)         } else if (csmElement instanceof CsmChild) {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 640)             CsmChild csmChild = (CsmChild)csmElement;
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 641)             if (textElement instanceof ChildTextElement) {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 642)                 ChildTextElement childTextElement = (ChildTextElement)textElement;
c4bbfa706 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 19:26:24 -0400 643)                 return childTextElement.getChild() == csmChild.getChild();
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 644)             }
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 645)         } else {
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 646)             throw new UnsupportedOperationException();
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 647)         }
                                                                                                                                                                          648)
51472755f javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 649)         return false;
5123e075b javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-10 21:47:00 -0400 650)     }
                                                                                                                                                                          651)
10508ce2a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 652)     private int adjustIndentation(List<TokenTextElement> indentation, NodeText nodeText, int nodeTextIndex, boolean followedByUnindent) {
7121d100d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 653)         List<TextElement> indentationAdj = processIndentation(indentation, nodeText.getElements().subList(0, nodeTextIndex - 1));
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 654)         if (nodeTextIndex < nodeText.getElements().size() && nodeText.getElements().get(nodeTextIndex).isToken(RBRACE)) {
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 655)             indentationAdj = indentationAdj.subList(0, indentationAdj.size() - Math.min(STANDARD_INDENTATION_SIZE, indentationAdj.size()));
10508ce2a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 656)         } else if (followedByUnindent) {
10508ce2a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 657)             indentationAdj = indentationAdj.subList(0, Math.max(0, indentationAdj.size() - STANDARD_INDENTATION_SIZE));
7121d100d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 658)         }
7121d100d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 659)         for (TextElement e : indentationAdj) {
10508ce2a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 660)             if ((nodeTextIndex< nodeText.getElements().size()) && nodeText.getElements().get(nodeTextIndex).isSpaceOrTab()) {
10508ce2a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 661)                 nodeTextIndex++;
10508ce2a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 662)             } else {
7121d100d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 663)                 nodeText.getElements().add(nodeTextIndex++, e);
10508ce2a javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-05-21 07:26:14 -0400 664)             }
7121d100d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 665)         }
7121d100d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 666)         return nodeTextIndex;
7121d100d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 667)     }
                                                                                                                                                                          668)
e71e376b9 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 669)     private boolean isAReplacement(int diffIndex) {
a25f53f88 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 21:15:57 -0400 670)         return (diffIndex > 0) && diffElements.get(diffIndex) instanceof Added && diffElements.get(diffIndex - 1) instanceof Removed;
e71e376b9 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 671)     }
                                                                                                                                                                          672)
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 673)     private boolean isReplaced(int diffIndex) {
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 674)         return (diffIndex < diffElements.size() - 1) && diffElements.get(diffIndex + 1) instanceof Added && diffElements.get(diffIndex) instanceof Removed;
2d3f5e219 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-06-07 16:54:17 -0400 675)     }
                                                                                                                                                                          676)
26bf9b3ff javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 677)     private boolean isPrimitiveType(TextElement textElement) {
26bf9b3ff javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 678)         if (textElement instanceof TokenTextElement) {
26bf9b3ff javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 679)             TokenTextElement tokenTextElement = (TokenTextElement)textElement;
a55cd517d javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:20:07 -0500 680)             int tokenKind = tokenTextElement.getTokenKind();
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 681)             return tokenKind == BYTE
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 682)                 || tokenKind == CHAR
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 683)                 || tokenKind == SHORT
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 684)                 || tokenKind == INT
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 685)                 || tokenKind == LONG
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 686)                 || tokenKind == FLOAT
9192b9d17 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Danny van Bruggen   2017-03-06 11:15:04 -0500 687)                 || tokenKind == DOUBLE;
26bf9b3ff javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 688)         } else {
26bf9b3ff javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 689)             return false;
26bf9b3ff javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 690)         }
26bf9b3ff javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Federico Tomassetti 2017-02-23 11:19:33 -0500 691)     }
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 692)     @Override
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 693)     public String toString() {
04f28d402 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/Difference.java                  (Thomas Leu          2018-05-18 20:42:18 -0400 694)         return "Difference{" + diffElements + '}';
cc13f68e3 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 695)     }
c73ae5d79 javaparser-core/src/main/java/com/github/javaparser/printer/lexicalpreservation/LexicalDifferenceCalculator.java (Federico Tomassetti 2017-02-23 11:19:33 -0500 696) }
